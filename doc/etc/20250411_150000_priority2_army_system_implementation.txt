# 种火集结号 - 优先级2：军队系统实装
时间戳: 2025-04-11 15:00:00

## 实装内容总结

我们已经完成了优先级2的第三部分：军队系统的实装。以下是已实装的内容：

### 1. 数据库表
- armies表：存储军队基本信息
- army_units表：存储军队单位信息
- battles表：存储战斗记录

### 2. Army类
- 实现了军队的基本属性和方法
- 支持创建、移动、攻击和解散军队
- 实现了军队战斗力和移动速度的计算
- 提供了检查军队到达和返回的方法

### 3. Battle类
- 实现了战斗的基本属性和方法
- 支持创建和执行战斗
- 实现了战斗结果、损失和奖励的计算
- 提供了应用战斗结果的方法

### 4. 前端界面
- armies.php：军队管理页面，显示军队列表和创建新军队
- move_army.php：军队移动页面，支持设置目标坐标

### 5. API接口
- create_army.php：创建新军队
- disband_army.php：解散军队
- return_army.php：军队返回城池
- get_city_soldiers.php：获取城池中的士兵
- attack_target.php：攻击目标
- get_battle_report.php：获取战斗报告

### 6. 定时任务
- 检查行军中的军队是否已到达目标
- 检查返回中的军队是否已返回城池
- 检查待处理的战斗并执行

## 军队系统功能

### 1. 军队管理
- 创建新军队：从城池中选择士兵组建军队
- 解散军队：将军队中的士兵返回城池
- 查看军队信息：显示军队组成、状态和位置

### 2. 军队移动
- 移动军队：设置目标坐标，军队开始行军
- 返回城池：军队返回所属城池
- 查看军队位置：在地图上显示军队位置

### 3. 军队战斗
- 攻击目标：军队可以攻击其他军队、城池或地图格子
- 战斗结果：根据双方战斗力计算战斗结果
- 战斗损失：根据战斗结果计算双方损失
- 战斗奖励：根据战斗结果和目标类型计算奖励

## 军队状态

军队有四种状态：
1. idle（待命）：军队在城池中或待命状态
2. marching（行军）：军队正在前往目标
3. fighting（战斗）：军队正在战斗
4. returning（返回）：军队正在返回城池

## 战斗系统

战斗系统的核心逻辑如下：
1. 计算攻击方和防守方的战斗力
2. 根据双方战斗力计算战斗结果
3. 根据战斗结果计算双方损失
4. 根据战斗结果和目标类型计算奖励
5. 应用战斗结果，包括减少双方单位数量和分配奖励

## 下一步计划

接下来，我们将继续实现优先级2的剩余部分：

1. **NPC城池攻占**
   - 实现NPC城池的攻占机制
   - 添加NPC城池的奖励系统
   - 实现NPC城池的重生机制

2. **玩家之间的战斗**
   - 实现玩家城池的攻防系统
   - 添加战斗报告功能
   - 实现战斗奖励和惩罚机制

## 实装注意事项

1. 需要实现Soldier类，用于管理城池中的士兵
2. 需要修改City类，添加getSoldiers和getSoldierByType方法
3. 需要实现战斗报告页面，用于显示战斗详情
4. 需要修改地图页面，支持选择军队目标位置
