【种火集结号】游戏设计文档
文档版本：0.0.4
最终更新日：2025-03-31
文档作用：该文档存储了游戏的基础规则，机制和常量，当出现新机制时便会在本文档内更新或加笔。

游戏类型：oGame类资源管理+领地占据策略游戏
使用技术栈：PHP+MySQL+HTML+CSS+JavaScript
游戏整合：单独运转，或与常磐大逃杀的用户数据（参照/doc/repomix-dts.txt中的users表）互通，该选项需要在初始化时选择配置。

游戏玩法概述：
玩家扮演潜入数据之海的“钻探者”（Driller），在数据之海中修建城池，并通过在城池中建造设施产出资源，
使用资源产出兵力，招募武将，发展科技，提升城池防御，最终击败其他玩家，占据地图中心的【银白之孔】，成为数据之海的主宰。

游戏机制：
1. 基础地图配置：
地图为512*512的正方形网格地图（默认值，长宽数值可以配置），中心为【银白之孔】，地图上随机分布着资源点，NPC城池以及NPC主城三种建筑。

2. 资源点：
资源点（Resource Point）中包含一个或数个产出一种或数种资源的设施。
资源有六种，会分别产出亮晶晶（白色），暖洋洋（红色），冷冰冰（蓝色），郁萌萌（绿色），昼闪闪（黄色）与夜静静（黑色）六种资源。
资源按照真实时间产出，默认值是每3秒产出一点，但应该可以进行配置。
此外，也存在一种名为【思考回路】的特殊资源，该资源需要通过升级玩家自身，或建造特殊设施，或兑换从常磐大逃杀中来的切糕（参照/doc/repomix-dts.txt中的users表之credits2字段）来产出，
将地图方块攻打下来后，将其占为己有以扩充领地范围，就需要消耗【思考回路】（Circuit）。
玩家可以选择放弃自己已经攻打下的地图方块，届时思考回路将会返还。
地图上有50%的方格都会是资源点，资源点中包含的单种资源产出设施最多不超过3个，包含的资源种类最多不超过4种。
资源点中按照资源的种类与数量，会出现不同种类和数量的守军。

3. NPC城池：
NPC城池（NPC Fort）中必定包含2个产出全部6种资源的设施。
NPC城池有着从1到9的等级，城池中对应等级驻扎着对应数量及等级的守军。
地图上有25%的方格会生成NPC城池，NPC城池的等级与其数量成反比。

4. NPC主城以及【银白之孔】：
地图上将会出现12个NPC主城（NPC Gateway），其本质上为等级10的NPC城池。以及位于地图中心的【数据之孔】（The Hole），其本质上为等级（11+属于NPC的NPC主城数量）的NPC城池。
12个主城会平均分布在地图上，以中心坐标，如钟表盘般向四周扩散。
12个主城的名称分别为：
1点方向：【明京】（Minjing）
2点方向：【宁海】（Ninghai）
3点方向：【五岳】（Wuyue）
4点方向：【陆合】（Luhai）
5点方向：【米萨瓦】（Misawa）
6点方向：【卡拉塔】（Kanata）
7点方向：【约左拉】（Yozora）
8点方向：【娜奥美】（Naomi）
9点方向：【明斯特尔】（Minster）
10点方向：【艾尔利斯】（Elise）
11点方向：【雷德奈芙】（Redknife）
12点方向：【开里培拉】（Caeperra）

示例NPC城池，NPC主城以及银白之孔基础强度保存在/doc/example_NPC_Force.txt中。

5. 玩家城池：
玩家加入游戏后，便会在地图随机地点生成玩家的第一座城池（Fort），玩家城池中必定包含3个产出全部6种资源的设施。
玩家可以随时使用随机名称自定义自己的城池的名称。
玩家城池本身是24x24的正方形网格，上述产生资源的设施会分布在城池的四个角落。
玩家可以在城池的其他空间内建造各种设施，下文详述。
玩家在攻打下资源点后，可将其改造成为玩家城池【分基地】（Sub-Base），届时返还消费的【思考回路】。玩家能拥有的分基地数量与玩家等级成正比。

6. 武将
玩家可以消费切糕或亮晶晶来招募武将。
武将有着不同的罕贵等级（B，A，S，SS，P），一般来说，罕贵等级越高，属性和技能越强大。
武将以卡片形式抽出来，卡面上有着以下信息：
ID：武将的唯一标识符
名称：武将的名称
来源：武将角色的来源
卡图：武将的立绘/卡图
稀有度：武将的罕贵等级
COST：从1.0到4.0的数值，以0.5为单位，高COST的武将属性更强大
元素：武将也存在上文所述的六种元素之一：亮晶晶，暖洋洋，冷冰冰，郁萌萌，昼闪闪，夜静静。

武将的元素决定其定位和初期携带技能卡：
亮晶晶：内政型武将，智力高，速度中，攻击力低，守备力高。
暖洋洋：速攻型武将，攻击力高，速度高，智力中，守备力低。
冷冰冰：防御型武将，守备力高，速度低，智力中，攻击力中。
郁萌萌：强攻型武将，智力中，速度高，攻击力高，守备力低。
昼闪闪：辅助型武将，攻击力低，速度高，智力高，守备力中。
夜静静：特殊型武将，智力高，速度中，攻击力低，守备力高。

属性：武将的数值属性，分为HP，攻击力，守备力，智力和速度，除了HP固定为100外，其他属性按照罕贵和COST的数值成正比。
HP：武将的血量，固定为100，HP为0时不可将武将分配至城池或兵队中。HP会随着时间缓慢回复。
攻击力：武将的单兵攻击力。
守备力：武将的单兵防御力。
速度：武将的单兵移动速度，也会影响士兵的移动速度。
智力：武将的智力，会影响技能的效果/效率。
等级：起始为LV1，可以通过在总督府中消费亮晶晶进行升级。
技能卡牌和技能卡组：武将的技能，武将自带一个技能卡牌，同时存在两个技能卡牌空位，玩家可以消耗夜静静资源来抽出技能卡让武将进行装备，每个技能有不同的效果。技能的效力与技能本身以及武将的智力相关。（技能下文详述）
技能显示在武将卡片背面，可以通过点击武将卡片翻面。

示例武将设定存放在/doc/example-general-design.txt中。

7. 设施
玩家可以消耗暖洋洋，冷冰冰，郁萌萌，昼闪闪四种资源，在玩家城池中建造设施。
每个设施都占用1个方格，以下设施默认就出现在玩家城池中：
【资源产出点】：如上文所述产出各色资源的设施。可以升级来提高产出效率。
【总督府】：玩家城池的中心建筑，有耐久值。可以升级来提高耐久值上限。且每48小时会产出1点【思考回路】。
以下设施需要玩家进行建造：
【兵营】：为玩家城池添加消耗资源产出兵力的功能。士兵的详情见下文。可以进行升级，来解锁等级更高的兵种。可以复数建造。
【研究所】：研究科技，科技的详情见下文。可以进行升级来解锁更高级的科技。只能拥有一个。
【宿舍】：让玩家可以存放士兵，宿舍越多能存放的士兵则越多。可以升级来提升存放士兵的上限。可以复数建造。
【贮存所】：让玩家可以存放更多的资源，贮存所越多能存放的资源则越多。可以升级来提升存放资源的上限。可以复数建造。
【瞭望台】：提高城池防御力，可以消耗资源产出侦察兵。也可以揭晓来自其他玩家城池的侦察兵情报。升级可以进一步提高城池防御力，并提升侦察兵以及能侦测到的侦察兵的等级。只能拥有一个。
【工程所】：可以研究科技来提高城池防御力，并可以消耗资源产出锤子兵。只能拥有一个。
升级设施需要消耗四种资源，且需要消耗显示时间，该时间可以被城池中驻扎的武将的智力以及正在发动中的技能修正。

8. 士兵
玩家可以训练四种普通士兵和两种特殊士兵。
【普通士兵】：在兵营中进行建造。
【兵卒（Pawn）】：最基础的步兵，需要消耗昼闪闪资源制造。训练速度快，速度高，攻击力低，守备力高。对锤子兵有额外伤害。对城池防御与总督府防御伤害低。
【骑士（Knight）】：以速度见长的中阶步兵，需要消耗暖洋洋资源制造。训练速度中等，速度高，攻击力中，守备力低。对兵卒，城壁有额外伤害。对城池防御与总督府防御伤害低。
【城壁（Rook）】：以防御见长的中阶步兵，需要消耗冷冰冰资源制造。训练速度中等，速度低，攻击力中，守备力高。对兵卒，主教有额外伤害。对城池防御与总督府防御伤害低。
【主教（Bishop）】：以攻击见长的中阶步兵，需要消耗郁萌萌资源制造。训练速度中等，速度中，攻击力高，守备力中。对兵卒，骑士有额外伤害。对城池防御与总督府防御伤害低。
【特殊士兵】：锤子兵在工程所进行建造，侦察兵在瞭望台进行建造
【锤子兵（Golem）】：以攻城见长的特殊步兵，需要消耗暖洋洋，冷冰冰，郁萌萌，昼闪闪四种资源制造。训练速度慢，速度低，攻击力低，守备力低。对城池防御与总督府防御有额外伤害。
【侦察兵（Scout）】：以侦察见长的特殊步兵，需要消耗暖洋洋，冷冰冰，郁萌萌，昼闪闪四种资源制造。训练速度快，没有战斗力，派去其他玩家城池不会在界面上显示倒计时等信息，但只要玩家或NPC城池的侦察兵数量少于派出的侦察兵数量，便可返回玩家或NPC城池的信息。

能训练的士兵的最高等级与兵营·瞭望台·工程所的等级有关。升级这些建筑会自动提升已有的士兵的等级。
一个城池内能训练的士兵的数量与宿舍的等级与数量有关。

9. 科技
科技分为以下几种：（以下都为TODO，需要做出框架以及范例/模板科技）
具体的科技设计将存储在/doc/tech-design.txt中。
科技包含以下属性：
科技名称：科技的名称
科技描述：科技描述
科技效果值：科技将会影响的效果值。（如适用）
科技升级基础费用：升级科技需要的费用。
科技等级系数：每一级将会增长的系数。影响科技效果值与科技升级费用。

科技种类：
【资源科技】：提高资源产出效率。（每种资源的产出速率，以及资源贮存上限）
【士兵科技】：提高士兵的属性。（士兵的攻击力，守备力，速度，制造时间）
【城池科技】：提高城池的防御力。（城池防御力，总督府防御力）
【总督府科技】：玩家的最高武将费用，为技能卡进行升级等。

每种科技最高能研究到的等级与研究所的等级有关。

10. 技能
技能分为以下几种：（以下都为TODO，需要做出框架以及范例/模板技能）
具体的技能设计将存储在/doc/skill-design.txt中。
技能包含可以主动发动的技能，该技能必须在城池界面上/出兵界面上进行发动，发动后有冷却时间。
以及被动发动的技能，该技能只要在城池中驻扎，或作为军队的一部分派出便可常时自动发动。
【内政类技能】：如提高本城池资源生产效率，以及提高本城池士兵生产效率等。
【进军类技能】：提高士兵的移动速度等。
【强攻类技能】：提高自身或者/以及自身士兵的攻击力等。
【其他类技能】：使用就能获得资源的技能，或者使用就可以回复HP的技能等。
技能有以下的参数：
技能名称：技能的名称
技能描述：技能的描述
技能类型：主动技能，被动技能
技能等级：影响技能数值的系数
技能基础冷却时间：如主动技能，使用技能后将消耗的现实时间

11. 互动
玩家自身互动：
玩家可以将自己的士兵任意数量派遣至自己的领地范围内的方块上，也能将这些士兵撤回让它们返回自己的城池。
调动士兵需要消耗现实时间，该时间与士兵的速度相关。
玩家可以将自己的武将以及任意数量士兵派遣至自己的其他城池，该调动也需要消耗现实时间，但该时间与武将的速度相关。

PVE互动：
玩家可以使用自己的武将，并可选让其派遣士兵，攻打地图上与自己领地邻接的方格。
如果是空白方格，可以直接占领，且不需要使用【思考回路】，便能将其纳入自己的领地范围内。
如果是资源点方格，则需要消灭其中驻扎的全部士兵，然后需要消耗【思考回路】，才能将其纳入自己的领地范围 - 哪怕是攻打成功后，思考回路不足的场合，该方格将不会纳为自己的领地范围。
如果是NPC城池或NPC主城，则先需要消灭其中驻扎的全部士兵，然后再消耗掉NPC城池的全部耐久度，方可将其纳入自己的领地范围且作为自己的城池。

PVP互动：
玩家可以通过派出武将并（可选）携带士兵，攻打自己领地邻接的其他玩家的领地和城池。被攻打的玩家会在自己的界面上看到来袭方以及军队到达倒计时。
领地的场合，只要消灭其中驻扎的全部士兵，并且有空余的【思考回路】，便可将该领地纳入自己的领地范围。（如领地中没有士兵，则直接占领）
城池的场合，需要消灭其中驻扎的全部士兵和武将，然后消耗掉该城池的全部耐久度，并且有空余的【思考回路】，便可攻打下该城池。
被攻打的玩家的最后一座城池被攻打下来后，该玩家便会被纳入攻打方，玩家可以选择向其缴纳大量资源，并放弃自己（可能还）拥有的全部领地（这些领地也归攻打下其的玩家所有），随机在地图上的其他位置重新开始。

玩家结盟：
玩家可以与其他玩家进行结盟，结盟后互相不能攻打各自的领地，且可以通过同时出兵聚合起兵力。
因为最后一座城池被攻打下来后而被纳入攻打方的玩家也属于一种结盟。

12. 游戏的结束
有玩家占领了【银白之孔】后，且将其持续占领一段时间（默认30天）后，游戏结束。该玩家胜利。
要占领银白之孔，必须至少占领1个NPC主城。
游戏结束后，将会在48小时后进行初始化，玩家持有的武将以外的数据，以及整个地图将会全部清零，重新生成。
游戏结束后至下一轮游戏开始前，玩家不能进行任何城池与地图相关的游戏操作，但仍旧可以进行抽取武将与技能，升级武将，升级武将技能卡等武将相关操作。

逻辑设定：
1. 常量
以下系数应该是可以通过配置文件以及网站后台在初始化游戏时配置的常量，游戏进行时无法修改：
地图大小，默认512*512。
【思考回路】的产出速率，默认每48小时产出1点。
资源产出速率，默认每3秒产出1点。
资源贮存初始值，默认为100000。
资源贮存效率，默认每个贮存所增加100000的贮存上限。且每个贮存所每一级就增加150%。
兵种制造基础时间，默认兵卒1秒/个，中级兵种（骑士/城壁/主教）5秒/个，锤子兵30秒/个，侦察兵2秒/个。
兵种基础速度，默认兵卒与侦察兵2秒/格，骑士1秒/格，城壁5秒/格，主教3秒/格，锤子兵30秒/格。
兵种基础对兵攻击力，默认兵卒1，骑士2，城壁2，主教4，锤子兵1。
兵种基础对城池攻击力，默认兵卒1，骑士2，城壁2，主教2，锤子兵10。
兵种基础对兵防御力，默认兵卒1，骑士2，城壁4，主教2，锤子兵1。
NPC城池强度，默认1级NPC城池拥有3000耐久度，每级增加1.5倍。
NPC驻军强度，默认1级NPC城池拥有1000兵力，每级增加2.5倍。
NPC资源点强度，默认每个资源点内每有一种资源（暖洋洋，冷冰冰，郁萌萌，昼闪闪）就拥有对应兵种（骑士，城壁，主教，兵卒）的100兵力。
NPC强度系数，影响NPC城池强度，驻军强度与资源点强度的系数，默认为100%。
游戏结束判定时间：玩家占领了【数据之孔】后需要将其持续占领的时间，默认30天。

2. 变量
以下变量和系数供随时调整游戏的难度使用，游戏进行时也能修改：
技能冷却修正倍率，默认100%。
兵种攻击力修正倍率，默认100%。（同时影响对攻城倍率）
兵种防御力修正倍率，默认100%。
军队移动速度修正倍率，默认100%。
武将HP回复倍率，默认100%。
科技研究倍率，默认100%。
技能冷却倍率，默认100%。

3. 计算公式
军队战斗力：
攻打NPC或玩家的空地，资源点，城池等方格时，需要进行军队战斗力测算。
该战斗力测算公式如下：
攻击侧：军队出发时判定（武将攻击力+对应各种兵种的攻击力*兵种等级系数*对应兵种数量）*特定技能修正 + 特定技能修正
防御侧：军队到达时判定（武将防御力+对应各种兵种的防御力*兵种等级系数*对应兵种数量）*特定技能修正 + 特定技能修正
攻击侧大于防御侧则攻击成功，否则攻击失败。
攻击成功的场合，防御侧士兵全灭，攻击侧按照攻击侧和防御侧的战斗力差距百分比，按比例削减士兵数量。
攻击失败的场合，攻击侧士兵全灭，防御侧按照防御侧和攻击侧的战斗力差距百分比，按比例削减士兵数量。
只有城池中不存在其他士兵的场合，锤子兵才能对城池耐久值造成伤害。

军队速度：
军队速度决定了军队从一处移动到另一处所要花费的时间。
该速度测算公式如下：
（（军队中行动最慢的兵种的速度）* 出发点到目标的格子距离）* 技能修正值
根据公式算出移动军队所使用的现实时间，以倒计时模式显示在玩家界面上。
攻打的是玩家的场合，该时间也会以倒计时模式，显示在被攻击的玩家界面上。


玩家发展度：
每一种设施均具有其单独发展度值，每升一级该值会按照特定倍率上升。
（TODO：将每一种设施以及其单独发展度值与升级系数列于/doc/design_structure_parameters.txt中。）

玩家界面：
基础模式参照常磐大逃杀的界面模式（/doc/repomix-dts.txt中template/default/下内容）
界面分为页首，页面本体视图及页脚三个区域

页首：
第一行大字居中显示游戏标题
第二行小字居中显示当前页面标题（目前主页面视图所在地图坐标 - 城池名称（如有） / 主页面当前功能名称）
第三行为页首导航，其中包含以下链接按钮：
【主基地】：转到主基地的城池界面。
【档案】：转到用户档案界面。
【武将】：转到武将卡界面。
【地图】：转到地图界面。
【内政】：转到内政界面。
【排名】：转到排名界面。
剩余【思考回路】数量 / 共计【思考回路】数量

页面本体视图：
【城池】界面：显示玩家选择的地图坐标对应的24x24的正方形网格。
空地的场合，显示空白网格。
资源点的场合，网格中包含该地对应的资源点种类和数量。
NPC城池或主城的场合，网格中心显示NPC总督府。
其他玩家的城池的场合，在该城池对应的位置显示该城池中对应的设施。
可以在界面上选择攻打，进入出兵界面

自己的城池的场合，在城池对应的位置显示该城池中对应的设施与等级。
在此基础上：
点击城池中空地，转至【建造新设施】界面
点击城池中对应的设施，转至对应的设施界面

【资源产出点】界面：显示该产出点产出的资源种类和数量，以及升到下一级所须的资源。并给出升级选项。
【总督府】界面：显示该城池可容纳的最大士兵数量，城池内已有的士兵数量，以及升到下一级所须的资源。并给出升级选项。
【兵营】界面：显示每一种士兵的训练费用，玩家可以指定一种士兵和一定数量进行训练。以及设施升到下一级所须的资源。并给出设施升级选项。
【研究所】界面：列出所有科技，并显示当前已研究到的等级，以及升到下一级所须的资源。并给出升级选项。以及设施升到下一级所须的资源。并给出设施升级选项
【宿舍】界面：显示当前宿舍中最多士兵数量以及已有士兵数量，以及设施升到下一级所须的资源。并给出设施升级选项
【贮存所】界面：显示当前贮存所中最多资源数量以及已有资源数量，以及设施升到下一级所须的资源。并给出设施升级选项
【瞭望台】界面：显示侦察兵的训练费用，玩家可以指定一定数量进行训练。以及设施升到下一级所须的资源。并给出设施升级选项。
【工程所】界面：显示锤子兵的训练费用，玩家可以指定一定数量进行训练。以及设施升到下一级所须的资源。并给出设施升级选项。

【出兵】界面：显示攻打目标的坐标（X，Y），该坐标也可以填写。玩家可以在该界面选择带兵武将并选择发动其能力（如适用），以及不超过自己所持兵力的士兵数量，组成军队。
点击界面上的确认出兵按钮，进入确认界面，显示攻打目标的坐标，军队中的武将，适用的技能（如适用），各种士兵数量，以及该军队的战斗力。
在该界面可以选择确认或放弃出兵，确认的场合则进行出兵，放弃则返回前一界面。
